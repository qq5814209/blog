<!DOCTYPE html>
<html lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="renderer" content="webkit">
    <meta name="force-rendering" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1">
    <meta name="referrer" content="always">
    <title>写文章-CSDN博客</title>
    <link rel="stylesheet" href="css/content_toolbar.css">
    <link href="css/commons.7cd971a.css" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="css/check-adb.css">
    <link rel="stylesheet" type="text/css" href="css/editor.css">
    <link rel="stylesheet" type="text/css" href="css/tableselection.css">
    <link rel="stylesheet" type="text/css" href="css/wordcount.css">
    <link rel="stylesheet" type="text/css" href="css/balloonpanel.css">
    <link rel="stylesheet" type="text/css" href="css/imagebase.css">
    <link rel="stylesheet" type="text/css" href="css/equation-embed.css">
    <link rel="stylesheet" href="wangeditor/css/wangEditor.min.css">
    <script src="wangeditor/js/wangEditor.min.js"></script>
</head>
<body>
<div id="csdn-toolbar" class="csdn-toolbar tb_disnone  csdn-toolbar-skin-black ">
</div>
<link rel="stylesheet" href="css/share.min.css">
<textarea id="txtSammary" style="display:none" placeholder="请填写文章摘要，如未填写则摘要由系统生成" maxlength="256"></textarea>
<link rel="stylesheet" href="css/ck_htmledit_views-cd6c485e8b.css">
<link href="css/ckeditor.7cd971a.css" type="text/css" rel="Stylesheet">
<main role="main" class="container">
    <div class="row row-offcanvas row-offcanvas-right main-wrapper">
        <div id="left-menu">

        </div>
        <div class="col-12 col-md-10" id="content-body">
            <div class="title-box">
                <input type="text" id="txtTitle" maxlength="100" placeholder="输入文章标题">
                <span class="max-length"><span class="max-length-change" id="titleLength">0</span>/30</span>
            </div>
            <div class="section">
                <div id="editor" class="cke_1 cke cke_reset cke_chrome cke_editor_editor cke_ltr cke_browser_webkit">

                </div>
                <!--<input type="button" id="test1" value="拿html"/>
                <input type="button" id="test2" value="拿text"/>-->
            </div>
            <div id="moreDiv">
                <div class="pos-box">
                    <div class="form-group row form-control-sm">
                        <!--<label class="labTitle col-form-label">个人分类：</label>
                        <div class="txt-box">
                            <div class="tag-box d-flex flex-row" id="categorieBox" >
                                <input name="hidTags" id="hidCategories" value="" type="hidden">
                                <div class="tag" id="tag" style="display: none">
                                    <span class="name" id="typeSpan" contenteditable="true"></span>
                                </div>
                                <div>
                                    <button class="btn-add-tag" id="addCategorie" onclick="X()">
                                        <i class="xheIcon icon-tianjia mr8" aria-hidden="true">
                                        </i>添加个人分类
                                    </button>
                                </div>
                            </div>
                        </div>-->
                    </div>
                    <div class="form-group row form-control-sm d-flex">
                        <label class="labTitle col-form-label">博客类型：</label>
                        <div class="txt-box">
                            <select class="droBlogType" id="radCh2" name="radChl">
                                <!--<option value="0">选择分类</option>
                                <option value="28">人工智能</option>-->
                            </select>
                            <span class="required">*</span>
                        </div>

                        <label class="labTitle col-form-label">个人分类：</label>
                        <div class="txt-box">
                            <select class="droBlogType" id="radCh1" name="radChl">
                                <!--<option value="0">选择分类</option>
                                <option value="28">人工智能</option>-->
                            </select>
                            <span class="required">*</span>
                        </div>

                        <div class="txt-box">
                            <div class="tag-box d-flex flex-row" id="categorieBox" >
                                <input name="hidTags" id="hidCategories" value="" type="hidden">
                                <div class="tag" id="tag" style="display: none">
                                    <span class="name" id="typeSpan" contenteditable="true"></span>
                                </div>
                                <div>
                                    <button class="btn-add-tag" id="addCategorie" onclick="X()">
                                        <i class="xheIcon icon-tianjia mr8" aria-hidden="true">
                                        </i>添加新个人分类
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-group row form-control-sm">

                    </div>
                    <div class="opt-box row unfull">
                        <label class="labTitle col-form-label"></label>
                        <div class="txt-box">
                            <input id="btnPublish" type="button" class="btn btn-outline-danger" value="发布博客"
                                   title="发布博客">
                            <input id="btnDraft" type="button" class="btn btn-outline-danger ml-24 btn-baocun"
                                   value="保存为草稿" title="保存为草稿">
                            <input id="btnCancel" type="button" class="btn btn-outline-secondary ml-24 btn-shanchu"
                                   title="返回列表页" value="返回">
                        </div>
                    </div>
                </div>
            </div>
            <div class="alert-mask d-none"></div>
            <div class="suspension-edit-box d-none">
                <div class="d-flex flex-row">
                    <button class="btn btn-danger btn-fabu"><i class="xheIcon icon-fabu"></i><span class="txt">发布</span>
                    </button>
                    <button class="btn btn-circle btn-baocun"><i class="xheIcon icon-baocun"></i><span
                            class="txt">保存</span></button>
                    <button class="btn btn-circle btn-shanchu"><i class="xheIcon icon-lajitong"></i><span
                            class="txt">返回</span></button>
                </div>
            </div>
        </div>
    </div>
</main>
<div class="notice-box"><i class="mr8 notice-icon type-success"></i>
    <div class="pacman hide">
        <div></div>
        <div></div>
        <div></div>
        <div></div>
        <div></div>
    </div>
    <span class="notice">文章发布成功</span></div>
<script>

</script>

<div style="position:fixed; top:0; left:0; overflow:hidden;"></div>
<div id="bdSug_1560392438808" class="bdSug_wpr" style="display: none;"></div>
</body>
<script src="jquery/jquery-2.1.1.min.js"></script>
<script src="bootstrap-3.3.7-dist/js/bootstrap.min.js" type="text/javascript"></script>
<script>
    $("#left-menu").load("module/bkgl_left_menu.html",function () {
        $("#write").attr("class","list-group-item active");
    });
    $("#csdn-toolbar").load("module/bk_header.html");

    function X() {
        $("#tag").css("display","block");
    }


    $.ajax({
        type:'GET',
        url:"selectPersonTypeAndBlogType",
        success:function (data) {
            console.log(data);
            var html1 = "<option>选择已有类型</option>\n";
            var html2;
            $("#radCh1").append(html1);
            $("#radCh2").append(html1);
            $(data[0]).each(function (index, item) {
                html1 =
                    "<option value='"+item.pt_id+"'>"+item.persontype_name+"</option>\n";
                $("#radCh1").append(html1);

            });
            $(data[1]).each(function (index, item) {
                html2 =
                    "<option value='"+item.bt_id+"'>"+item.blogtype_name+"</option>\n";
                $("#radCh2").append(html2);

            })
        }
    })

    //富文本编辑器
    var E = window.wangEditor;
    var editor = new E('#editor'); // 两个参数也可以传入 elem 对象，class 选择器
    //开启debug模式
    editor.customConfig.debug = true;
    // 关闭粘贴内容中的样式
    editor.customConfig.pasteFilterStyle = false;
    // 忽略粘贴内容中的图片
    editor.customConfig.pasteIgnoreImg = false;
    // 使用 base64 保存图片
    //editor.customConfig.uploadImgShowBase64 = true
    // 上传图片到服务器
    editor.customConfig.uploadFileName = 'editorFile'; //设置文件上传的参数名称
    editor.customConfig.uploadImgServer = 'upload1'; //设置上传文件的服务器路径
    editor.customConfig.uploadImgMaxSize = 10 * 1024 * 1024; // 将图片大小限制为 3M
    //自定义上传图片事件
    editor.customConfig.uploadImgHooks = {
        before: function(xhr, editor, files) {

        },
        success: function(xhr, editor, result) {
            console.log("上传成功");
        },
        fail: function(xhr, editor, result) {
            console.log("上传失败,原因是" + result);
        },
        error: function(xhr, editor) {
            console.log("上传出错");
        },
        timeout: function(xhr, editor) {
            console.log("上传超时");
        }
    }
    editor.create();


    //控制标题字符数量
    var $txtTitle = $("#txtTitle");
    $("#txtTitle").bind("keyup",function () {
        var length = $txtTitle.val().length;
        if(length <= 30){
            $("#titleLength").text(length);
        }else {
            alert("标题数量不能超过30个字符");
        }

    });

    //发布博客
    $("#btnPublish").bind("click",function(){
        var txtTitle = $txtTitle.val();
        var content = editor.txt.html();
        var typeSpan;
        var typeSpan1 = $("#typeSpan").text();
        var typeSpan2 = $("#radCh1 option:selected").val();
        typeSpan = typeSpan1 == ""? typeSpan2:typeSpan1;
        var blogType = $("#radCh2 option:selected").val();
        console.log(txtTitle);
        console.log(content);
        console.log(typeSpan);
        console.log(blogType);

        $.ajax({
            type:'POST',
            url:"writeBlog",
            data:{
                "txtTitle":txtTitle,
                "content":content,
                "typeSpan":typeSpan,
                "blogType":blogType
            },
            success:function (data) {
                if(data === 200){
                    alert(data.message);
                    window.location.reload()
                }else {
                    alert(data.message);
                    window.location.reload()
                }
            }
        })
    });

</script>
</html>